<div>
    <h2>Interface</h2>

    <!-- <h3>General</h3> -->
    <div class="settings-group" id="enable-interface-panel">
        <div class="custom-control custom-switch">
            <input type="checkbox" class="custom-control-input" id="interface-enabled-checkbox">
            <label class="custom-control-label" for="interface-enabled-checkbox">Enable annotation interface</label>
        </div>

        <!-- <input type="checkbox" id="interface-enabled-checkbox" />
        <label for="interface-enabled-checkbox">Enable annotation interface</label>
        <br />

        <input type="checkbox" id="show-image-names-checkbox" />
        <label for="show-image-names-checkbox">Show file names below images</label>
        <br />
        <div style="margin-left:20px">
            <input type="checkbox" id="show-image-uris-checkbox" disabled />
            <label for="show-image-uris-checkbox">Enable hyperlinks to images</label>
        </div> -->
    </div>

    <h3>Image viewer</h3>
    <div class="settings-group">
        <input type="checkbox" id="show-image-names-checkbox" />
        <label for="show-image-names-checkbox">Show file names below images</label>
        <br />
        <div style="margin-left:20px">
            <input type="checkbox" id="show-image-uris-checkbox" disabled />
            <label for="show-image-uris-checkbox">Enable hyperlinks to images</label>
        </div>
    </div>

    <div class="settings-group"></div>
        <table>
            <tr>
                <td>Number of images on screen:</td>
                <td><input class="number-input" id="field-numImgsPerBatch" type="number" min="1" max="128" /></td>
            </tr>
            <tr>
                <td>Default image width (pixels):</td>
                <td><input class="number-input" id="field-defaultImageWidth" type="number" min="32" max="8192" /></td>
            </tr>
            <tr>
                <td>Default image height (pixels):</td>
                <td><input class="number-input" id="field-defaultImageHeight" type="number" min="32" max="8192" /></td>
            </tr>
            <tr>
                <td>Minimum image width (pixels):</td>
                <td><input class="number-input" id="field-minImageWidth" type="number" min="32" max="8192" /></td>
            </tr>
        </table>
    </div>

    <h3>AI model predictions</h3>
    <div class="settings-group">
        <!-- <input type="checkbox" id="show-predictions-checkbox" /> -->
        <!-- <label for="show-predictions-checkbox">Show model predictions</label> -->
        <table>
            <tr>
                <td>Default minimum confidence for prediction visibility:</td>
                <td><input class="number-input" id="field-minModelConfidence-show" type="number" min="0" max="1" /></td>
            </tr>
        </table>

        <!-- <input type="checkbox" id="carryover-predictions-checkbox" />
        <label for="carryover-predictions-checkbox">Automatically convert predictions to annotations</label> -->
        <table>
            <tr>
                <td>Default minimum confidence for auto-conversion of predictions to annotations:</td>
                <td><input class="number-input" id="field-minModelConfidence-convert" type="number" min="0" max="1" /></td>
            </tr>
            <tr>
                <td>Conversion rule (in case of multiple predictions):</td>
                <td>
                    <select id="field-conversionRule">
                        <option value="maxConfidence">Max confidence</option>
                        <option value="mode">Most frequently predicted label</option>
                    </select>
                </td>
            </tr>
        </table>
    </div>

    <div id="display-styles-group" class="settings-group">
        <h3>Display styles</h3>

        <!-- TODO: think about how to design this... maybe with preview? -->
        <div id="styles-panel">
            <div>
                <div id="styles-points" style="display:none">
                    <h4>Point size</h4>
                    <table>
                        <tr>
                            <td>Annotations:</td>
                            <td><input id="point-size-annotations" type="number" min="0.0" max="100.0" step="0.1" /></td>
                        </tr>
                        <tr>
                            <td>Converted annotations:</td>
                            <td><input id="point-size-annotations-converted" type="number" min="0.0" max="100.0" step="0.1" /></td>
                        </tr>
                        <tr>
                            <td>Predictions:</td>
                            <td><input id="point-size-predictions" type="number" min="0.0" max="100.0" step="0.1" /></td>
                        </tr>
                    </table>
                </div>

                <div id="styles-lines" style="display:none">
                    <h4>Line width</h4>
                    <table>
                        <tr>
                            <td>Annotations:</td>
                            <td><input id="line-width-annotations" type="number" min="0.0" max="100.0" step="0.1" /></td>
                        </tr>
                        <tr>
                            <td>Converted annotations:</td>
                            <td><input id="line-width-annotations-converted" type="number" min="0.0" max="100.0" step="0.1" /></td>
                        </tr>
                        <tr>
                            <td>Predictions:</td>
                            <td><input id="line-width-predictions" type="number" min="0.0" max="100.0" step="0.1" /></td>
                        </tr>
                    </table>

                    <h4>Line opacity</h4>
                    <table>
                        <tr>
                            <td>Annotations:</td>
                            <td>
                                <input id="line-opacity-annotations-range" type="range" min="0.0" max="1.0" step="any" />
                                <input class="number-small" id="line-opacity-annotations" type="number" min="0.0" max="1.0" step="0.1" />
                            </td>
                        </tr>
                        <tr>
                            <td>Converted annotations:</td>
                            <td>
                                <input id="line-opacity-annotations-converted-range" type="range" min="0.0" max="1.0" step="any" />
                                <input class="number-small" id="line-opacity-annotations-converted" type="number" min="0.0" max="1.0" step="0.1" />
                            </td>
                        </tr>
                        <tr>
                            <td>Predictions:</td>
                            <td>
                                <input id="line-opacity-predictions-range" type="range" min="0.0" max="1.0" step="any" />
                                <input class="number-small" id="line-opacity-predictions" type="number" min="0.0" max="1.0" step="0.1" />
                            </td>
                        </tr>
                    </table>

                    <h4>Line dash</h4>
                    <table>
                        <tr>
                            <td>Annotations:</td>
                            <td>
                                <input class="number-small" id="line-dash-annotations-0" type="number" min="0" max="10" step="1" />
                                <input class="number-small" id="line-dash-annotations-1" type="number" min="0" max="10" step="1" />
                                <input class="number-small" id="line-dash-annotations-2" type="number" min="0" max="10" step="1" />
                                <input class="number-small" id="line-dash-annotations-3" type="number" min="0" max="10" step="1" />
                                <input class="number-small" id="line-dash-annotations-4" type="number" min="0" max="10" step="1" />
                            </td>
                        </tr>
                        <tr>
                            <td>Converted annotations:</td>
                            <td>
                                <input class="number-small" id="line-dash-annotations-converted-0" type="number" min="0" max="1" step="1" />
                                <input class="number-small" id="line-dash-annotations-converted-1" type="number" min="0" max="1" step="1" />
                                <input class="number-small" id="line-dash-annotations-converted-2" type="number" min="0" max="1" step="1" />
                                <input class="number-small" id="line-dash-annotations-converted-3" type="number" min="0" max="1" step="1" />
                                <input class="number-small" id="line-dash-annotations-converted-4" type="number" min="0" max="1" step="1" />
                            </td>
                        </tr>
                        <tr>
                            <td>Predictions:</td>
                            <td>
                                <input class="number-small" id="line-dash-predictions-0" type="number" min="0" max="10" step="1" />
                                <input class="number-small" id="line-dash-predictions-1" type="number" min="0" max="10" step="1" />
                                <input class="number-small" id="line-dash-predictions-2" type="number" min="0" max="10" step="1" />
                                <input class="number-small" id="line-dash-predictions-3" type="number" min="0" max="10" step="1" />
                                <input class="number-small" id="line-dash-predictions-4" type="number" min="0" max="10" step="1" />
                            </td>
                        </tr>
                    </table>
                </div>
                <div id="styles-fill">
                    <h4>Fill opacity</h4>
                    <table>
                        <tr>
                            <td>Annotations:</td>
                            <td>
                                <input id="fill-opacity-annotations-range" type="range" min="0.0" max="1.0" step="any" />
                                <input class="number-small" id="fill-opacity-annotations" type="number" min="0.0" max="1.0" step="0.1" />
                            </td>
                        </tr>
                        <tr>
                            <td>Converted annotations:</td>
                            <td>
                                <input id="fill-opacity-annotations-converted-range" type="range" min="0.0" max="1.0" step="any" />
                                <input class="number-small" id="fill-opacity-annotations-converted" type="number" min="0.0" max="1.0" step="0.1" />
                            </td>
                        </tr>
                        <tr>
                            <td>Predictions:</td>
                            <td>
                                <input id="fill-opacity-predictions-range" type="range" min="0.0" max="1.0" step="any" />
                                <input class="number-small" id="fill-opacity-predictions" type="number" min="0.0" max="1.0" step="0.1" />
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
            <div id="styles-preview-entry">
                <h4>Styles preview:</h4>
            </div>
        </div>
    </div>
</div>
<style>
    h3 {
        font-size: 22px;
    }
    h4 {
        font-size: 18px;
    }
    .number-input {
        width: 80px;
    }
    .number-small {
        width: 60px;
    }
    #styles-panel {
        display: flex;
        flex-direction: row;
    }
    #styles-preview-entry {
        flex-grow: 1;
        margin-left: 40px;
    }
    .entry {
        display: block !important;
        width: 500px;
    }

    .custom-control-input {
        position: relative;
    }

    .custom-control-label {
        font-size: 14pt;
        left: 10px;
    }

    .custom-switch .custom-control-label::before {
        left: -2.8rem;
        width: 2.5rem;
        height: 1.5rem;
        border-radius: .8rem;
    }

    .custom-switch .custom-control-label::after {
        left: calc(-2.8rem + 2px);
        top: calc(.3rem + 2px);
        width: calc(1.3rem - 4px);
        height: calc(1.3rem - 4px);
    }

    .custom-switch .custom-control-input:checked~.custom-control-label::after {
        -webkit-transform: translateX(1rem);
        transform: translateX(1rem);
    }

    #enable-interface-panel {
        background: #606060;
        padding: 20px;
        padding-left: 0;
        border-radius: 10px;
    }
</style>
<script type="text/javascript" src="/static/interface/js/labelClassHandler.js?v={{ version }}"></script>
<script type="text/javascript" src="/static/interface/js/dataEntry.js?v={{ version }}"></script>
<script type="text/javascript" src="/static/interface/js/annotationPrimitives.js?v={{ version }}"></script>
<script type="text/javascript" src="/static/interface/js/viewport/imageViewport.js?v={{ version }}"></script>
<script type="text/javascript" src="/static/interface/js/renderPrimitives.js?v={{ version }}"></script>
<script type="text/javascript" src="/static/interface/js/util.js?v={{ version }}"></script>
<script type="text/javascript" src="/static/interface/js/dataHandler.js?v={{ version }}"></script>
<script type="text/javascript">

    // field-to-token mapping
    var PROPERTIES_MAP = {
        'interface_enabled': {id: 'interface-enabled-checkbox', type: 'checkbox'},
        'ui_settings/showImageNames': {id: 'show-image-names-checkbox', type: 'checkbox'},
        'ui_settings/showImageURIs': {id: 'show-image-uris-checkbox', type: 'checkbox'},
        'ui_settings/numImagesPerBatch': {id: 'field-numImgsPerBatch', type: 'value'},
        'ui_settings/defaultImage_w': {id: 'field-defaultImageWidth', type: 'value'},
        'ui_settings/defaultImage_h': {id: 'field-defaultImageHeight', type: 'value'},
        'ui_settings/minImageWidth': {id: 'field-minImageWidth', type: 'value'},
        // 'ui_settings/showPredictions': {id: 'show-predictions-checkbox', type: 'checkbox'},
        'ui_settings/showPredictions_minConf': {id: 'field-minModelConfidence-show', type: 'value'},
        // 'ui_settings/carryOverPredictions': {id: 'carryover-predictions-checkbox', type: 'checkbox'},
        'ui_settings/carryOverPredictions_minConf': {id: 'field-minModelConfidence-convert', type: 'value'},
        'ui_settings/carryOverRule': {id: 'field-conversionRule', type: 'value'},

        // styles
        'ui_settings/styles/annotations/pointSize': {id: 'point-size-annotations', type: 'value', dtype: 'float'},
        'ui_settings/styles/annotations_converted/pointSize': {id: 'point-size-annotations-converted', type: 'value', dtype: 'float'},
        'ui_settings/styles/predictions/pointSize': {id: 'point-size-predictions', type: 'value', dtype: 'float'},
        'ui_settings/styles/annotations/lineWidth': {id: 'line-width-annotations', type: 'value', dtype: 'float'},
        'ui_settings/styles/annotations_converted/lineWidth': {id: 'line-width-annotations-converted', type: 'value', dtype: 'float'},
        'ui_settings/styles/predictions/lineWidth': {id: 'line-width-predictions', type: 'value', dtype: 'float'},
        'ui_settings/styles/annotations/lineOpacity': {id: 'line-opacity-annotations', type: 'value', dtype: 'float'},
        'ui_settings/styles/annotations_converted/lineOpacity': {id: 'line-opacity-annotations-converted', type: 'value', dtype: 'float'},
        'ui_settings/styles/predictions/lineOpacity': {id: 'line-opacity-predictions', type: 'value', dtype: 'float'},
        'ui_settings/styles/annotations/fillOpacity': {id: 'fill-opacity-annotations', type: 'value', dtype: 'float'},
        'ui_settings/styles/annotations_converted/fillOpacity': {id: 'fill-opacity-annotations-converted', type: 'value', dtype: 'float'},
        'ui_settings/styles/predictions/fillOpacity': {id: 'fill-opacity-predictions', type: 'value', dtype: 'float'}
    };

    function _parse_config_value(data, key) {
        try {
            // retrieve value from data object
            let tokens = key.split('/');
            var value = data;
            for(var i=0; i<tokens.length; i++) {
                value = value[tokens[i]];
            }
            
            // apply in DOM
            let prop = PROPERTIES_MAP[key];
            let id = prop['id'];
            let type = prop['type'];
            if(type === 'checkbox') {
                $('#'+id).prop('checked', value);
            } else if(type === 'value') {
                let dType = prop['dtype'];
                if(typeof(dType) === 'string') {
                    if(dType === 'int') {
                        value = parseInt(value);
                    } else if(dType === 'float') {
                        value = parseFloat(value);
                    }
                }
                $('#'+id).val(value);
            }
        }Â catch {
            return;
        }
    }

    function _set_config_value(dataObj, tokens, value) {
        if(Array.isArray(tokens) && tokens.length > 1) {
            if(!dataObj.hasOwnProperty(tokens[0])) {
                dataObj[tokens[0]] = {};
            }
            _set_config_value(dataObj[tokens[0]], tokens.slice(1), value);
        } else {
            if(Array.isArray(tokens)) {
                tokens = tokens[0];
            }
            dataObj[tokens] = value;
        }
        return dataObj;
    }

    function reloadUIsettings() {
        return $.ajax({
            url: window.baseURL + 'getProjectSettings',
            method: 'GET',
            success: function(data) {
                // populate fields
                data = data['settings'];

                //TODO: just temporarily
                data['ui_settings'] = data;
                window.styles = data['ui_settings']['styles'];
                window.dataServerURI = data['dataServerURI'];
                if(!window.dataServerURI.endsWith('/')) {
                    window.dataServerURI += '/';
                }

                for(var key in PROPERTIES_MAP) {
                    _parse_config_value(data, key);
                }
                // special cases: line dash
                let dTypes = ['annotations', 'annotations_converted', 'predictions'];
                for(var dt in dTypes) {
                    let key = dTypes[dt];
                    let lineDash = data['ui_settings']['styles'][key]['lineDash'];
                    for(var l=0; l<5; l++) {
                        $('#line-dash-'+key.replace('_','-')+'-'+l).val('');
                    }
                    if(Array.isArray(lineDash)) {
                        for(var l=0; l<lineDash.length; l++) {
                            $('#line-dash-'+key.replace('_','-')+'-'+l).val(lineDash[l]);
                        }
                    }
                }
                
                // update GUI elements (sliders, checkboxes, etc.)
                $.each($.find('input[type=range]'), function(_, item) {
                    let id_num = '#'+item.id.replace('-range', '');
                    $(id_num).trigger('input');
                });
                $('#show-image-uris-checkbox').prop('disabled', !$('#show-image-names-checkbox').prop('checked'));

                // adjust global interface shortlink button on config page
                try {
                    if($('#interface-enabled-checkbox').prop('checked')) {
                        $('#start-labeling-button').show();
                        $('#interface-disabled-placeholder').hide();
                    } else {
                        $('#start-labeling-button').hide();
                        $('#interface-disabled-placeholder').show();
                    }
                } catch {}
            },
            error: function(xhr, status, error) {
                console.error(error);
                if(typeof(xhr) === 'object' && xhr.hasOwnProperty('status') && xhr['status'] !== 401) {
                    window.messager.addMessage('An error occurred while trying to load interface configuration (message: "' + error + '").', 'error', 0);
                }
            },
            statusCode: {
                401: function(xhr) {
                    return window.renewSessionRequest(xhr, function() {
                        return reloadUIsettings();
                    });
                }
            }
        });
    }

    function gatherSettings() {
        var data = {};
        for(var key in PROPERTIES_MAP) {
            let prop = PROPERTIES_MAP[key];
            let id = prop['id'];
            let type = prop['type'];
            var value = undefined;
            if(type === 'checkbox') {
                value = $('#'+id).prop('checked');
            } else if(type === 'value') {
                value = $('#'+id).val();
                let dType = prop['dtype'];
                if(typeof(dType) === 'string') {
                    if(dType === 'int') {
                        value = parseInt(value);
                    } else if(dType === 'float') {
                        value = parseFloat(value);
                    }
                }
            }
            if(value !== undefined) {
                var tokens = key.split('/');
                data = _set_config_value(data, tokens, value);
            }
        }
        
        // special cases: line dash
        let dTypes = ['annotations', 'annotations-converted', 'predictions'];
        for(var dt in dTypes) {
            let key = dTypes[dt];
            let lineDash = [];
            for(var i=0; i<5; i++) {
                let ld = $('#line-dash-'+key+'-'+i).val();
                if(ld.length > 0) {
                    lineDash.push(parseInt(ld));
                }
            }
            data['ui_settings']['styles'][key.replace('-','_')]['lineDash'] = lineDash;
        }
        return data;
    }

    function saveUIsettings() {
        // retrieve parameters first
        let data = gatherSettings();

        // post to server
        return $.ajax({
            url: window.baseURL + 'saveProjectConfiguration',
            method: 'POST',
            contentType: 'application/json; charset=utf-8',
            dataType: 'json',
            data: JSON.stringify(data),
            success: function(data) {
                return reloadUIsettings().done(function() {
                    // window.messager.addMessage('Configuration saved successfully.', 'success');
                    return $.Deferred().promise();
                });
            },
            error: function(xhr, status, error) {
                console.error(error);
                if(typeof(xhr) === 'object' && xhr.hasOwnProperty('status') && xhr['status'] !== 401) {
                    window.messager.addMessage('An error occurred while trying to save interface configuration (message: "' + error + '").', 'error', 0);
                }
            },
            statusCode: {
                401: function(xhr) {
                    return window.renewSessionRequest(xhr, function() {
                        return saveUIsettings();
                    });
                }
            }
        });
    }

    function loadSampleData() {
        // dummy entries for compatibility
        window.dataType = 'images';
        window.eventTypes = [];
        window.projectShortname = window.project;
        window.showPredictions = true;  //$('#show-predictions-checkbox').prop('checked');
        window.showPredictions_minConf = parseFloat($('#field-minModelConfidence-convert'));
        window.carryOverPredictions = true; //$('#carryover-predictions-checkbox').prop('checked');
        window.carryOverRule = $('#field-conversionRule').val();
        window.uiControlHandler = {
            getDefaultCursor() {
                return 'default';
            },
            loupeVisible() {
                return false;
            },
            segmentation_properties: {
                brushType: 'rectangle',
                brushSize: 20,
                opacity: 0.75
            }
        }
        window.labelClassHandler = {
            getColor(label) {
                return '#FF0000';
            },
            getName(label) {
                return 'Label';
            },
            getActiveClassID() {
                return '';
            },
            getByIndex(index) {
                return {
                    colorValues: '#FF0000'
                }
            }
        }

        // load data
        return $.ajax({
            url: window.baseURL + 'getSampleData',
            method: 'GET',
            success: function(data) {
                let key = Object.keys(data)[0];
                data = data[key];

                // limit predictions if multiple are available
                try {
                    let predKeys = Object.keys(data['predictions']);
                    if(predKeys.length > 5) {
                        let predictions_subset = {};
                        for(var p=0; p<5; p++) {
                            predictions_subset[predKeys[p]] = data['predictions'][predKeys[p]];
                        }
                        data['predictions'] = predictions_subset;
                    }
                } catch {}

                // create new data entries
                window.sampleEntry = null;
                switch(String(window.projectImmutables['annotationType'])) {
                    case 'labels':
                        window.sampleEntry = new ClassificationEntry(key, data, true);
                        break;
                    case 'points':
                        window.sampleEntry = new PointAnnotationEntry(key, data, true);
                        break;
                    case 'boundingBoxes':
                        window.sampleEntry = new BoundingBoxAnnotationEntry(key, data, true);
                        break;
                    case 'polygons':
                        window.sampleEntry = new PolygonAnnotationEntry(key, data, true);
                    default:
                        break;
                }
                $('#styles-preview-entry').append(window.sampleEntry.markup);
            },
            error: function(xhr, status, error) {
                console.error(error);
                if(typeof(xhr) === 'object' && xhr.hasOwnProperty('status') && xhr['status'] !== 401) {
                    window.messager.addMessage('An error occurred while trying to load sample data for visualization (message: "' + error + '").', 'error', 0);
                }
            },
            statusCode: {
                401: function(xhr) {
                    return window.renewSessionRequest(xhr, function() {
                        return loadSampleData();
                    });
                }
            }
        });
    }

    function redrawSampleImage() {
        if(window.sampleEntry === undefined || window.sampleEntry === null) return;

        // gather general values
        window.showPredictions = true;  //$('#show-predictions-checkbox').prop('checked');
        window.showPredictions_minConf = parseFloat($('#field-minModelConfidence-convert'));
        window.carryOverPredictions = true; //$('#carryover-predictions-checkbox').prop('checked');
        window.carryOverRule = $('#field-conversionRule').val();

        // gather all styles
        let styles = gatherSettings()['ui_settings']['styles'];
        for(var key in styles) {
            window.styles[key] = styles[key];
        }
        window.sampleEntry.styleChanged();
    }

    function getProjectImmutables() {
        return $.ajax({
            url: window.baseURL + 'getProjectImmutables',
            method: 'GET',
            success: function(data) {
                window.projectImmutables = data['immutables'];
                window.annotationType = window.projectImmutables['predictionType'];
                window.predictionType = window.projectImmutables['predictionType'];

                // show or hide GUI fields according to annotation and prediction types (TODO: could be made better by hiding individual sections)
                if(window.annotationType === 'labels') {
                    $('#styles-fill').hide();
                } else if(window.annotationType === 'points' || 
                    window.predictionType === 'points') {
                    $('#styles-points').show();
                } else if(window.annotationType === 'boundingBoxes' || 
                    window.predictionType === 'boundingBoxes') {
                    $('#styles-lines').show();
                } else if(window.annotationType === 'segmentationMasks') {
                    $('#display-styles-group').hide();
                }
            },
            error: function(xhr, status, error) {
                console.error(error);
                if(typeof(xhr) === 'object' && xhr.hasOwnProperty('status') && xhr['status'] !== 401) {
                    window.messager.addMessage('An error occurred while trying to load project properties (message: "' + error + '").', 'error', 0);
                }
            },
            statusCode: {
                401: function(xhr) {
                    return window.renewSessionRequest(xhr, function() {
                        return getProjectImmutables();
                    });
                }
            }
        });
    }
    
    window.save = function() {
        window.showLoadingOverlay(true);
        return saveUIsettings().then(function() {
            window.showLoadingOverlay(false);
        });
    }

    $(document).ready(function() {

        // initiate dummy data handler for preview
        window.dataHandler = new DataHandler(null);

        // get project immutables
        var promise = getProjectImmutables();

        // get current UI settings
        promise = promise.then(function() {
            return reloadUIsettings();
        });

        $('#show-image-names-checkbox').on('click', function() {
            $('#show-image-uris-checkbox').prop('disabled', !$(this).prop('checked'));
        });

        // load sample data
        promise = promise.then(function() {
            if(window.annotationType !== 'segmentationMasks') {
                $.each($.find('input'), function(_, item) {
                    $(this).on('input', function() {
                        redrawSampleImage();
                    });
                });
                return loadSampleData();
            } else {
                return $.Deferred().resolve().promise();
            }
        });

        promise = promise.then(function() {
            $.each($.find('input[type=range]'), function(_, item) {
                let id = '#'+item.id;
                let id_num = id.replace('-range', '');
                $(this).on('input', function() {
                    $(id_num).val($(this).val());
                    redrawSampleImage();
                });
                $(id_num).on('input', function() {
                    $(id).val($(this).val());
                    redrawSampleImage();
                });
                $(id_num).trigger('input');
            });

            window.showLoadingOverlay(false);
        });
    });
</script>